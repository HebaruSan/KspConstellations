CONTRACT_TYPE
{
	sortKey = a
	name = ConstellationsKsoRelay
	group = RelayConstellations

	title = Place kerbostationary relay above the KSC
	description = As awesome as the tracking station is, being at almost sea level limits its field of view. We started looking for a spot for a dish on the nearby mountain range before Wernher von Kerman barged into the room: 'This is not high enough, we are a space agency god damn it!'.\nApparently, a kerbostationary orbit is as high as it gets if we want a constant line of sight to the KSC. We managed to secure some funds, so we want you to place a strong relay in KSO directly above the Space Center.

	synopsis = Place a relay satellite in kerbostationary orbit above the KSC

	maxCompletions = 1
	maxSimultaneous = 1

	completedMessage = The relay is in position and working!

	prestige = Significant

	targetBody = HomeWorld()

	rewardScience = 0
	rewardReputation = @RelayConstellations:ksoBaseReputation
	rewardFunds = @RelayConstellations:ksoBaseFunds
	advanceFunds = @rewardFunds / 3
	failureReputation = @rewardReputation
	failureFunds = @advanceFunds

	REQUIREMENT
	{
		name = StockKerbin
		type = Expression
		title = The homeworld is good ol' Kerbin
		expression = HomeWorld().CanHaveSynchronousOrbit(0) && HomeWorld().Radius() <= 600000
	}

	REQUIREMENT
	{
		name = SolarPanelsUnlocked
		type = Any

		title = Have solar panels unlocked.

		REQUIREMENT
		{
			name = StockSolar
			type = PartModuleUnlocked
			partModule = ModuleDeployableSolarPanel
		}
		REQUIREMENT:NEEDS[NearFutureSolar]
		{
			name = NFSolar
			type = PartModuleUnlocked
			partModule = ModuleCurvedSolarPanel
		}
		REQUIREMENT:NEEDS[Kopernicus]
		{
			name = KopernicusSolar
			type = PartModuleUnlocked
			partModule = KopernicusSolarPanel
		}
	}

	REQUIREMENT
	{
		name = RendezvousDone
		type = Rendezvous
	}

	REQUIREMENT
	{
		name = TechResearched
		type = TechResearched

		part = RelayAntenna100
	}

	BEHAVIOUR
	{
		name = SpawnVessel
		type = SpawnVessel

		VESSEL
		{
			name = KSO Relay Marker A
			craftPart = constellations-dummy
			owned = False
			targetBody = HomeWorld()
			vesselType = DroppedPart

			ORBIT
			{
				SMA = 3463334.0398701429
				ECC = 0
				INC = 0
				LPE = 237.38459898406168
				LAN = 0
				MNA = 1.5322871042446775
				EPH = 18545.434569902998
				REF = 1
			}
		}
	}

	PARAMETER
	{
		name = Relay
		type = VesselParameterGroup

		define = KSO Relay A
		dissassociateVesselsOnContractCompletion = true

		PARAMETER
		{
			name = NewVessel
			type = NewVessel
		}

		PARAMETER
		{
			name = HasCrew
			type = HasCrew
			minCrew = 0
			maxCrew = 0
		}

		PARAMETER
		{
			name = HasAntenna
			type = HasAntenna
			minAntennaPower = 200000000000 // 200G
			antennaType = RELAY
			notes = This will probably require multiple antennas, remember that combining antennas is non-linear.\nAlso note that difficulty settings alters the antenna power, so there might be a mismatch between antenna ratings shown in VAB and the actual power.
		}

		PARAMETER
		{
			name = PowerGenerator
			type = Any
			title = Have solar panels onboard
			hideChildren = !@Constellations:DEBUG

			PARAMETER
			{
				name = StockSolarGenerator
				type = PartValidation
				partModule = ModuleDeployableSolarPanel
				minCount = 1
			}
		
			PARAMETER:NEEDS[NearFutureSolar]
			{
				name = NFSolarGenerator
				type = PartValidation
				partModule = ModuleCurvedSolarPanel
				minCount = 1
			}
		
			PARAMETER:NEEDS[Kopernicus]
			{
				name = KopernicusSolarGenerator
				type = PartValidation
				partModule = KopernicusSolarPanel
				minCount = 1
			}
		}

		PARAMETER
		{
			name = VesselIsType
			type = VesselIsType
			vesselType = Relay
		}

		PARAMETER
		{
			name = Orbit
			type = Orbit

			minPeriod = 5h 59m 4s
			maxPeriod = 5h 59m 14s

			minPeA = 2860834
			maxApA = 2865834

			maxInclination = 0.1

			notes = An ideal kerbostationary orbit has a period of 5h 59m 9s and an altitude of 2863334 meters
		}

		PARAMETER
		{
			name = Rendezvous
			type = Rendezvous
			hideChildren = !@Constellations:DEBUG

			vessel = KSO Relay Marker A
			distance = 10000

			title = Place the relay within 10km of the marker

			disableOnStateChange = true
		}

		duration = 2d
	}

	PARAMETER
	{
		name = Precision1
		type = VesselParameterGroup

		vessel = KSO Relay A

		title = Circularize at 2863334m with less than 100m deviation (Optional)

		optional = True
		rewardReputation = @RelayConstellations:ksoPrecisionReputation
		rewardFunds = @RelayConstellations:ksoPrecisionFunds

		PARAMETER
		{
			name = Precision1Orbit
			type = Orbit
			hidden = !@Constellations:DEBUG
			hideChildren = !@Constellations:DEBUG

			minPeA = 2863234
			maxApA = 2863434
		}

		duration = 5s
	}

	PARAMETER
	{
		name = Precision2
		type = VesselParameterGroup

		vessel = KSO Relay A

		title = Circularize at 2863334m with less than 1m deviation (Optional)

		optional = True
		rewardReputation = 2 * @RelayConstellations:ksoPrecisionReputation
		rewardFunds = 2 * @RelayConstellations:ksoPrecisionFunds

		PARAMETER
		{
			name = Precision2Orbit
			type = Orbit
			hidden = !@Constellations:DEBUG
			hideChildren = !@Constellations:DEBUG

			minPeA = 2863333.5
			maxApA = 2863334.49
		}

		duration = 5s
	}

	PARAMETER
	{
		name = Precision3
		type = VesselParameterGroup

		vessel = KSO Relay A

		title = Place the relay within 100m of the marker (Optional)

		optional = True
		rewardReputation = @RelayConstellations:ksoPrecisionReputation
		rewardFunds = @RelayConstellations:ksoPrecisionFunds

		PARAMETER
		{
			name = Precision3Rendezvous
			type = Rendezvous
			hidden = !@Constellations:DEBUG
			hideChildren = !@Constellations:DEBUG

			vessel = KSO Relay Marker A
			distance = 100
		}
	}

	BEHAVIOUR
	{
		name = DestroyVessel
		type = DestroyVessel
		onState = CONTRACT_COMPLETED
		vessel = KSO Relay Marker A
	}
}
